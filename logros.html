<!-- TODO: Mismo <head> y estilos que antes... (omite para no repetir) -->

<div class="container">
  <h2 id="nombre-mascota-logros">Mascota</h2>

  <div class="progreso-section">
    <div class="barra-progreso">
      <div class="barra-progreso-inner" id="progress-bar-inner">0%</div>
    </div>
    <p class="counter-text">Ejercicios completados: <span id="exercise-count">0</span></p>
    <button class="btn-volver" onclick="agregarEjercicios()">Agregar ejercicios manualmente</button>
  </div>

  <div class="etapa-actual">
    <img id="imagen-etapa-actual" src="" alt="Mascota actual">
  </div>

  <button class="btn-volver" onclick="window.location.href='index.html'">Volver a la App</button>
</div>

<script>
  const MAX_EXERCISES = 10;

  const mascotStages = [
    { threshold: 0, stage: 1 },
    { threshold: 3, stage: 2 },
    { threshold: 6, stage: 3 },
    { threshold: 10, stage: 4 }
  ];

  function actualizarProgreso() {
    let exerciseCount = parseInt(localStorage.getItem('movivital_exercise_count') || '0', 10);
    if (isNaN(exerciseCount)) exerciseCount = 0;

    const selectedMascot = localStorage.getItem('movivital_mascot') || 'mascota_c.png';
    const customName = localStorage.getItem('movivital_mascot_name') || selectedMascot;
    const nombreVisible = customName.replace('.png', '');

    document.getElementById('nombre-mascota-logros').textContent = `Progreso de ${nombreVisible}`;
    document.getElementById('exercise-count').textContent = exerciseCount;

    let percentage = (exerciseCount / MAX_EXERCISES) * 100;
    if (percentage > 100) percentage = 100;

    const progressBar = document.getElementById('progress-bar-inner');
    progressBar.style.width = percentage + '%';
    progressBar.textContent = Math.round(percentage) + '%';

    const prefijo = selectedMascot.replace('.png', '').toLowerCase();
    let currentStage = 1;

    for (let i = mascotStages.length - 1; i >= 0; i--) {
      if (exerciseCount >= mascotStages[i].threshold) {
        currentStage = mascotStages[i].stage;
        break;
      }
    }

    const imgSrc = currentStage === 1 ? selectedMascot : `${prefijo}_stage${currentStage}.png`;
    document.getElementById('imagen-etapa-actual').src = imgSrc;
  }

  function agregarEjercicios() {
    const cantidad = prompt("¿Cuántos ejercicios realizaste?");
    const numero = parseInt(cantidad, 10);

    if (!isNaN(numero) && numero > 0) {
      let actual = parseInt(localStorage.getItem('movivital_exercise_count') || '0', 10);
      actual += numero;
      localStorage.setItem('movivital_exercise_count', actual);
      actualizarProgreso();
    } else {
      alert("Por favor, ingresa un número válido mayor que 0.");
    }
  }

  document.addEventListener('DOMContentLoaded', actualizarProgreso);
</script>
